<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>PDFlover ‚Äî –û–±–Ω–∞–∂–∏—Ç–µ–ª—å PDF</title>
  <style>
    :root {
      --primary: #6c6cd4;
      --primary-button: #9d9df5;
      --primary-light: #ededff;
      --primary-dark: #4545dd;
      --secondary: #673ab7;
      --accent: #ff5722;
      --light: #f8f9fa;
      --dark: #333;
      --success: #4caf50;
      --warning: #ff9800;
      --danger: #f44336;
      --info: #2196f3;
      --table-tag: #ff9800;
      --app-tag: #e53935;
      --text-tag: #03a9f4;
      --magic-green: #00ff00;
      --magic-purple: #9c27b0;
      --magic-lilac: #ce93d8;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      margin: 0;
      background: #fafafa;
      color: var(--dark);
      position: relative;
      padding-bottom: 180px;
    }
    h1 {
      font-size: 20px;
      color: var(--primary);
      text-align: center;
      margin-bottom: 10px;
      margin-top: 0;
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .file-section {
      text-align: center;
      margin-bottom: 30px;
    }
    .file-section input {
      display: none;
    }
    .file-section label {
      display: inline-block;
      padding: 14px 28px;
      background: var(--primary);
      color: white;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(111, 30, 233, 0.216);
    }
    .file-section label:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(111, 30, 233, 0.433);
    }
    .file-info {
      background: white;
      border: 1px solid #eee;
      border-radius: 12px;
      padding: 25px;
      margin: 20px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .file-info h3 {
      margin: 0 0 15px 0;
      color: var(--primary);
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .file-info h3::before {
      content: "üìÑ";
      font-size: 1em;
    }
    .stats {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin: 15px 0;
  justify-content: center;
}

.stat-box {
  background: rgba(145, 30, 233, 0.05);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.95em;
  font-weight: 500;
  color: var(--dark);
  border: 1px solid rgba(98, 30, 233, 0.2);
  display: flex;
  align-items: center;
  gap: 4px;
}
    /* .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .stat-box {
      background: var(--light);
      padding: 10px;
      border-radius: 10px;
      border-left: 5px solid var(--primary);
      text-align: center;
      transition: transform 0.3s;
    } */
    .stat-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .stat-box strong {
  font-size: 1.1em;
  color: var(--primary);
  margin: 0;
  font-weight: 600;
}
    /* .stat-box strong {
      display: block;
      font-size: 2em;
      color: var(--primary-dark);
      margin-bottom: 5px;
    } */
    .stat-box span {
      font-size: 0.95em;
      color: #666;
      font-weight: 500;
    }
    .content-section {
      margin: 30px 0;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      display: none;
    }
    .content-section:hover .cover-content{
      max-height: 300px;
    }
    .content-section h3 {
      color: var(--secondary);
      margin: 0 0 15px 0;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .content-section h3::before {
      content: "üéØ";
    }

    .cover-content {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      max-height: 100px;
      overflow-y: auto;
      border: 1px dashed #ccc;
      box-sizing: border-box;
    }
    .gear-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
    .gear-btn {
      background: white;
      border: 2px solid var(--primary);
      color: var(--primary);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: all 0.3s;
    }
    .gear-btn:hover {
      transform: rotate(90deg) scale(1.1);
      background: var(--primary);
      color: white;
    }
    .toolbar {
      position: fixed;
      background: white;
      border: 1px solid #eee;
      top:80px;
      padding: 20px;
      margin: 0px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      display: none;
      z-index: 1000;
    }
    .toolbar.active {
      display: block;
    }
    .toolbar-row {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    .toolbar-row:last-child {
      border-bottom: none;
    }
    .toolbar-content button,
    .toolbar-content input[type="number"],
    .toolbar-content input[type="text"],
    .toolbar-content input[type="color"] {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    .toolbar-content button {
      background: var(--primary);
      color: white;
      cursor: pointer;
      border: none;
      transition: all 0.3s;
      font-weight: 500;
    }
    .toolbar-content button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }
    .toolbar-content input[type="number"],
    .toolbar-content input[type="text"] {
      width: 50px;
      padding: 8px 12px;
      
    }
    .toolbar-content input[type="color"] {
      width: 50px;
      height: 60px;
      padding: 0;
      cursor: pointer;
    }
    #toolbarContent input[type="number"],
#toolbarContent input[type="text"] {
  padding: 6px 10px;
  font-size: 14px;
  height: 20px;
  width: 60px;
  border: 1px solid #ccc;
  border-radius: 4px;
  text-align: center;
}

#toolbarContent button {
  padding: 6px 12px;
  font-size: 14px;
  height: 35px;
  min-width: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
  background: var(--primary-button);
  color: white;
  cursor: pointer;
}
    .pages-container {
      display: flex;
      flex-direction: column;
      gap: 30px;
      margin-top: 30px;
    }
    .page-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      padding: 20px;
      transition: all 0.4s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      position: relative;
      overflow-y: scroll;
    }
    .page-card.checked {
      border-color: var(--primary);
      background: #f8f2fd;
      box-shadow: 0 5px 20px rgba(105, 30, 233, 0.15);
    }
    .page-card.highlighted {
      animation: pulse 1.5s infinite;
    }
    .page-card.collapsed {
      height: auto;
      max-height: 220px;
      overflow: hidden;
    }
    .page-card.expanded {
      max-height: 500px;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(233, 30, 99, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(233, 30, 99, 0); }
      100% { box-shadow: 0 0 0 0 rgba(233, 30, 99, 0); }
    }
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 2px solid #eee;
    }
    .page-number {
      font-weight: bold;
      color: var(--dark);
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .page-number::before {
      content: "üìÑ";
    }
    .page-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .page-checkbox {
      transform: scale(1.3);
      cursor: pointer;
      accent-color: var(--primary);
    }
    .page-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0 20px 0;
    }
    .tag {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    .tag:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .tag-text {
      background: rgba(3, 169, 244, 0.1);
      color: var(--text-tag);
      border-color: rgba(3, 169, 244, 0.3);
    }
    .tag-table {
      background: rgba(255, 152, 0, 0.15);
      color: var(--table-tag);
      border-color: rgba(255, 152, 0, 0.4);
    }
    .tag-app {
      background: rgba(229, 57, 53, 0.1);
      color: var(--app-tag);
      border-color: rgba(229, 57, 53, 0.3);
    }
    .tag.active {
      transform: scale(1.1);
    }
    .page-content {
      display: none;
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #eee;
      word-break: break-word;
    }
    .page-content.active {
      display: block;
    }
    .page-content p {
      margin: 0.5em 0;
      padding: 2px 0;
      line-height: 1.6;
    }
    .magic-green-bg {
      background-color: var(--magic-green) !important;
      padding: 2px 6px;
      border-radius: 4px;
      border: 2px solid #00aa00;
      display: inline-block;
      margin: 2px 0;
    }
    .magic-collapse-end {
      border-bottom: 3px solid var(--magic-green);
      margin: 10px 0;
    }
    .page-card.mini {
      width: 20px;
      height: 20px;
      padding: 0;
      margin: 0;
      position: absolute;
      transition: all 0.222s ease;
      cursor: default;
      box-shadow: none;
      border: none;
      border-radius: 4px;
    }
    .magic-purple-bg {
      background-color: var(--magic-purple);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .page-buttons {
      display: flex;
      gap: 12px;
      margin-top: 15px;
      flex-wrap: wrap;

    }
    .btn-icon {
  width: 40px;
  height: 40px;
  border: none;
  border-radius: 8px;
  background: var(--primary-light);
  outline: 2px solid var(--primary);
  color: white;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.btn-icon:hover {

  transform: scale(1.1);
}
    .btn {
      padding: 10px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
    }
    .btn-secondary {
      background: #6c757d;
    }
    .btn-secondary:hover {
      background: #545b62;
    }
    .btn-success {
      background: var(--success);
    }
    .btn-success:hover {
      background: #388e3c;
    }
    .table-tag, .app-tag, .search-tag {
      display: inline-block;
      color: #333;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      margin: 4px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;

    }
    .table-tag {
      background: #e5d9fa;
      border: 2px solid #9a89b691;
    }
    .app-tag {
      background: var(--magic-lilac);
      border-color: #ba68c8;
      color: #333;
    }
    .search-tag {
      background: var(--magic-lilac);
      border-color: #ba68c8;
      color: #333;
    }
    .table-tag:hover, .app-tag:hover, .search-tag:hover {
      transform: scale(1.08);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .table-tag.active, .app-tag.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary-dark);
    }
    .table-preview-tooltip.active {
  display: block;
}
    
    .preview-highlight {
      background-color: #4caf50;
      color: white;
      padding: 1px 3px;
      border-radius: 3px;
    }
    @keyframes rubberBand {
      from { transform: translateX(-50%) scale(0.1); }
      50% { transform: translateX(-50%) scale(1.1); }
      to { transform: translateX(-50%) scale(1); }
    }
    #status {
      display: block;
      margin: 20px 0;
      padding: 15px;
      background: #e3f2fd;
      border-left: 5px solid var(--info);
      color: #0d47a1;
      font-weight: 500;
      border-radius: 0 8px 8px 0;
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .magic-panel {
      position: fixed;
      bottom: 0;
      left: 20px;
      right: 20px;
      background: white;
      border: 3px solid var(--accent);
      box-shadow: 0 -4px 30px rgba(0,0,0,0.25);
      z-index: 1000;
      border-radius: 16px 16px 0 0;
      max-height: 80vh;
      overflow-y: auto;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      transform: translateY(0);
      padding: 0;
      display: none;
    }
    .magic-panel.collapsed {
      transform: translateY(calc(100% - 60px));
    }
    .magic-panel-header {
      padding: 15px 20px;
      background: rgba(255, 87, 34, 0.15);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      color: var(--accent);
      border-radius: 12px 12px 0 0;
      user-select: none;
    }
    .magic-panel-header:hover {
      background: rgba(255, 87, 34, 0.25);
    }
    .magic-panel-header::after {
      content: "üëá";
      font-size: 1.2em;
      transition: transform 0.3s;
    }
    .magic-panel.collapsed .magic-panel-header::after {
      transform: rotate(180deg);
    }
    .magic-tools {
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    .magic-tool {
      background: #fdf2f8;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #fce7f0;
      transition: all 0.3s;
    }
    .magic-tool:hover {
      border-color: var(--primary);
      box-shadow: 0 4px 15px rgba(233, 30, 99, 0.1);
    }
    .magic-tool h4 {
      margin: 0 0 12px 0;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.05em;
    }
    .magic-tool-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .magic-tool label {
      font-weight: 500;
      min-width: 110px;
      color: #555;
      font-size: 13px;
    }
    .magic-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      font-size: 14px;
      box-shadow: 0 3px 8px rgba(255, 87, 34, 0.3);
    }
    .magic-btn:hover {
      background: #e64a19;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 87, 34, 0.4);
    }
    .hidden-text {
      display: none !important;
    }
    @media (max-width: 768px) {
      body {
        padding: 15px;
        padding-bottom: 180px;
      }
      .magic-panel {
        left: 10px;
        right: 10px;
        border-radius: 10px 10px 0 0;
        display: none;
      }
      .magic-tools {
        grid-template-columns: 1fr;
        padding: 15px;
      }
      .pages-container {
        gap: 20px;
      }
      .page-card {
        padding: 15px;
      }
      #appList 
      {
        display: none;
      }
      #tableList h4
      {
        margin: 0; height: auto; background-color: #00ff0000;
      }
      .table-preview-trigger 
      {
        padding: 5px
      }

      .table-preview-tooltip {
        
  /* position: absolute; */
  height: 300px;
  width: 220px;
  left: 0;
  background: white;
  border: 2px solid var(--table-tag);
  border-radius: 8px;
  padding: 10px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
  z-index: 1001;
  display: none;
  overflow-y: auto;
  font-size: 12px;
  line-height: 1.4;

}

.table-preview-tooltip.active {
  display: block;
}

    }
    body:hover .magic-panel-header::after {
      animation: bounce 1s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-5px) rotate(10deg); }
    }
    .page-search-input {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  box-sizing: border-box;
}
.page-search-results {
  margin: 15px 0 30px 0;
  padding: 12px;
  background: #f0f8ff;
  border-radius: 8px;
  border: 1px dashed #87ceeb;
  display: none;
}
.page-search-results.active {
  display: block;
}
.page-search-results p {
  margin: 6px 0;
  line-height: 1.5;
}
.page-search-results mark {
  background: #ffeb3b;
  color: #333;
  padding: 0 3px;
  border-radius: 3px;
}
    /* .page-search-input {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  box-sizing: border-box;
}
.page-search-results {
  position: relative;
  margin-top: 10px;
  padding: 10px;
  background: #f0f8ff;
  border-radius: 6px;
  border: 1px dashed #87ceeb;
  max-height: 180px;
  overflow-y: auto;
  display: none;
}
.page-search-results.active {
  display: block;
}
.page-search-results p {
  margin: 6px 0;
  line-height: 1.5;
}
.page-search-results mark {
  background: #ffeb3b;
  color: #333;
  padding: 0 3px;
  border-radius: 3px;
} */
  </style>
</head>
<body>
  <h1>PDF reader</h1>
      <p style="padding: 5px;"><a href="index.html" style="color: inherit; text-decoration: none; display: block; height: 40px; width: 40px; position: absolute; top: 0; left: 0; margin: 10px;">‚Ü©Ô∏è </a></p>
  <div class="file-section">
    <input type="file" id="pdfFile" accept="application/pdf">
    <label for="pdfFile">üìÇ –í—ã–±–µ—Ä–∏—Ç–µ PDF —Ñ–∞–π–ª</label>
  </div>
  <div class="gear-panel">
    <button class="gear-btn" id="gearBtn" onclick="toggleToolbar()">‚öôÔ∏è</button>
  </div>
  <div class="toolbar" id="toolbarContent">
    <div class="toolbar-row">
      <label>–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
      <input type="number" id="pageNumberInput" min="1" value="1">
      <button onclick="goToPage()">üöÄ –ü–µ—Ä–µ–π—Ç–∏</button>
      <span id="pageInfo"></span>
    </div>
    <div class="toolbar-row">
      <label>–í—ã–±—Ä–∞—Ç—å:</label>
      <input type="number" id="rangeFrom" min="1" placeholder="–û—Ç">
      <span></span>
      <input type="number" id="rangeTo" min="1" placeholder="–î–æ">
      <button onclick="selectRange()">üéØ –í—ã–±—Ä–∞—Ç—å</button>
      <button onclick="selectAllPages()">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
    </div>
    <div class="toolbar-row">

      <button onclick="deselectAllPages()">–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ</button>
      <button onclick="downloadSelectedPdfPages()" class="btn-success">–°–∫–∞—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
      <span id="selectedCount" style="margin-left: 20px; color: var(--primary); font-weight: bold;"></span>
    </div>
    <div class="toolbar-row">
      <label>–ü–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤—É:</label>
      <input type="text" id="globalSearchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ" style="flex:1; padding: 8px 12px; font-size: 14px;">
      <button onclick="performGlobalSearch()">üîç –ù–∞–π—Ç–∏</button>
      <span id="searchResultsCount" style="margin-left: 10px; color: var(--magic-lilac); font-weight: bold;"></span>
    </div>
    <div id="globalSearchResults" style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 8px;"></div>
  </div>
  <div id="status" style="display:none;"></div>
  <div id="fileInfo" class="file-info" style="display:none;">
    <h3><span id="fileName">–ò–º—è —Ñ–∞–π–ª–∞</span></h3>
    <div class="stats">
      <div class="stat-box">
        <strong id="totalPages">0</strong>
        <span>—Å—Ç—Ä–∞–Ω–∏—Ü</span>
      </div>
      <div class="stat-box">
        <strong id="tableCount">0</strong>
        <span>—Ç–∞–±–ª–∏—Ü</span>
      </div>
      <!-- <div class="stat-box">
        <strong id="appCount">0</strong>
        <span>–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞–π–¥–µ–Ω–æ</span>
      </div>
      <div class="stat-box">
        <strong id="coverWords">0</strong>
        <span>—Å–ª–æ–≤ –Ω–∞ —Ç–∏—Ç—É–ª—å–Ω–æ–º –ª–∏—Å—Ç–µ</span>
      </div> -->
    </div>
    <div id="tableList" style="margin-top:5px; padding-top:0px; border-top:2px solid #eee;">
      <h4>üìã –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:</h4>
      <div id="tablesContainer" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px;"></div>
      <!-- <div id="tablesContainer" style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px;"></div> -->
    </div>
    <div id="appList" style="margin-top:20px; padding-top:20px; border-top:2px solid #eee;">
      <h4>üìé –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</h4>
      <div id="appsContainer" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;"></div>
    </div>
  </div>
  <div class="content-section" id="coverSection" style="display:none;">
    <h3>–¢–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç</h3>
    <div class="cover-content" id="coverContent"></div>
  </div>
  <div id="pagesContainer" class="pages-container"></div>

  <div class="magic-panel" id="magicPanel">
    <div class="magic-panel-header" onclick="toggleMagicPanel()">
      –ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ–±–Ω–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ ‚ú®
    </div>
    <div class="magic-tools">
      <div class="magic-tool">
        <h4>üîÆ –°–≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞</h4>
        <div class="magic-tool-row">
          <label>–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ:</label>
          <input type="text" id="collapseKeyword" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ" style="flex:1; padding: 8px 12px; font-size: 14px;">
        </div>
        <div class="magic-tool-row">
          <label>–°–∫—Ä—ã—Ç—å —Å—Ç—Ä–æ–∫:</label>
          <input type="number" id="collapseLines" min="1" value="5" style="width:70px; padding: 8px 12px; font-size: 14px;">
        </div>
        <button class="magic-btn" onclick="applyCollapseText()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞–≥–∏—é</button>
      </div>
      <div class="magic-tool">
        <h4>üé® –†–∞—Å–∫—Ä–∞—Å–∏—Ç—å —Å–ª–æ–≤–∞ –≤–æ–ª—à–µ–±–Ω–æ–π –∫–∏—Å—Ç—å—é</h4>
        <div class="magic-tool-row">
          <label>–°–ª–æ–≤–æ –¥–ª—è —Ä–∞—Å–∫—Ä–∞—Å–∫–∏:</label>
          <input type="text" id="colorKeyword" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ" style="flex:1; padding: 8px 12px; font-size: 14px;">
        </div>
        <div class="magic-tool-row">
          <label>–¶–≤–µ—Ç:</label>
          <input type="color" id="colorPicker" value="#ff5722" style="height: 36px; width: 40px;">
        </div>
        <button class="magic-btn" onclick="applyColorText()">–†–∞—Å–∫—Ä–∞—Å–∏—Ç—å!</button>
      </div>
      <div class="magic-tool">
        <h4>üíé –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏ —Å –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–æ–º</h4>
        <div class="magic-tool-row">
          <label>–ú–∞–≥–∏—á–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ:</label>
          <input type="text" id="filterKeyword" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ" style="flex:1; padding: 8px 12px; font-size: 14px;">
        </div>
        <div class="magic-tool-row">
          <label>–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–æ–∫:</label>
          <input type="number" id="filterLines" min="1" value="3" style="width:70px; padding: 8px 12px; font-size: 14px;">
        </div>
        <button class="magic-btn" onclick="applyFilterText()">–ê–±—Ä–∞–∫–∞–¥–∞–±—Ä–∞!</button>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    let pdfDocument = null;
    let totalPages = 0;
    let selectedPages = new Set();
    let tableOccurrences = [];
    let appOccurrences = [];
    let pageTexts = {};
    let globalSearchResults = [];
    let originalFileArrayBuffer = null;

    document.addEventListener('DOMContentLoaded', function() {
      const panel = document.getElementById('magicPanel');
      panel.classList.remove('collapsed');
    });

    document.getElementById('pdfFile').addEventListener('change', handleFileSelect);

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file || file.type !== 'application/pdf') {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ PDF —Ñ–∞–π–ª.');
        return;
      }
  // üëá –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
  document.querySelector('.file-section').style.display = 'none';
      showStatus('–û–±–Ω–∞–∂–∞–µ–º PDF... –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ üïµÔ∏è‚Äç‚ôÄÔ∏è');

      const fileReader = new FileReader();
      fileReader.onload = function() {
        originalFileArrayBuffer = this.result;
        const typedarray = new Uint8Array(this.result);
        const loadingTask = pdfjsLib.getDocument(typedarray);
        loadingTask.promise.then(async function(pdf) {
          pdfDocument = pdf;
          totalPages = pdf.numPages;
          
          // –û–±–Ω–æ–≤–ª—è–µ–º UI —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ñ–∞–π–ª–µ
          document.getElementById('fileName').textContent = file.name;
          document.getElementById('totalPages').textContent = totalPages;
          document.getElementById('fileInfo').style.display = 'block';
          document.getElementById('pageInfo').textContent = `(–≤—Å–µ–≥–æ ${totalPages} —Å—Ç—Ä–∞–Ω–∏—Ü)`;
          document.getElementById('pageNumberInput').max = totalPages;
          document.getElementById('rangeFrom').max = totalPages;
          document.getElementById('rangeTo').max = totalPages;

          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
          selectedPages.clear();
          tableOccurrences = [];
          appOccurrences = [];
          pageTexts = {};
          globalSearchResults = [];
          clearSearchResults();
          document.getElementById('selectedCount').textContent = '';
          document.getElementById('coverContent').innerHTML = '';
          document.getElementById('coverSection').style.display = 'none';

          // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          await analyzeAllPages(pdf);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          document.getElementById('tableCount').textContent = tableOccurrences.length;
          // document.getElementById('appCount').textContent = appOccurrences.length;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç
          await showCoverPage(pdf);
          
          // –†–µ–Ω–¥–µ—Ä–∏–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          await renderAllPages(pdf);
          
          // –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω—ã, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ —Ç–∞–±–ª–∏—Ü –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
          updateTableList();
          updateAppList();
          
          hideStatus();
          showStatus('PDF –≥–æ—Ç–æ–≤ –∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é üòé');
          setTimeout(hideStatus, 3000);
        }).catch(function(error) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ PDF:', error);
          hideStatus();
          alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å PDF —Ñ–∞–π–ª. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª.');
        });
      };
      fileReader.readAsArrayBuffer(file);
    }

    async function analyzeAllPages(pdf) {
      const tableKeywords = [
        '–¢–∞–±–ª–∏—Ü–∞', '–¢ –∞ –± –ª –∏ —Ü –∞', '—Ç–∞–±–ª.', '–¢–∞–±–ª–∏—Ü—ã', '–¢–∞–±–ª–∏—Ü–∞ ', '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç–∞–±–ª', '–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã',
        'Table', 'TABLE', 'Tbl.', 'tbl.'
      ];
      const appKeywords = [
        '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏', 'APPENDIX', 'Appendix', '–ü–†–ò–õ–û–ñ–ï–ù–ò–ï'
      ];

      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        try {
          const page = await pdf.getPage(pageNum);
          const textContent = await page.getTextContent();
          const items = textContent.items;
          items.sort((a, b) => {
            const yDiff = Math.round(a.transform[5]) - Math.round(b.transform[5]);
            if (yDiff !== 0) return yDiff;
            return a.transform[4] - b.transform[4];
          });

          let currentY = null;
          let textLines = [];
          let currentLine = [];
          items.forEach(item => {
            const y = Math.round(item.transform[5]);
            if (currentY === null) {
              currentY = y;
            }
            if (Math.abs(y - currentY) > 5) {
              textLines.push(currentLine.join(' '));
              currentLine = [];
              currentY = y;
            }
            currentLine.push(item.str);
          });
          if (currentLine.length > 0) {
            textLines.push(currentLine.join(' '));
          }

          const pageText = textLines.join('\n');
          pageTexts[pageNum] = {
            fullText: pageText,
            lines: textLines,
            items: items,
            hasTable: false,
            hasApp: false
          };

          // –ü–æ–∏—Å–∫ —Ç–∞–±–ª–∏—Ü
          for (const keyword of tableKeywords) {
            let lastIndex = 0;
            while (lastIndex < pageText.length) {
              const index = pageText.indexOf(keyword, lastIndex);
              if (index === -1) break;
              let tableText = keyword;
              const afterKeyword = pageText.substring(index + keyword.length, index + keyword.length + 15);
              const numberMatch = afterKeyword.match(/^[\s\d\.\-\(\)]+/);
              if (numberMatch) {
                tableText += numberMatch[0].trim();
              }
              tableOccurrences.push({
                page: pageNum,
                text: tableText.trim()
              });
              pageTexts[pageNum].hasTable = true;
              lastIndex = index + 1;
            }
          }

          // –ü–æ–∏—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
          for (const keyword of appKeywords) {
            let lastIndex = 0;
            while (lastIndex < pageText.length) {
              const index = pageText.indexOf(keyword, lastIndex);
              if (index === -1) break;
              let appText = keyword;
              const afterKeyword = pageText.substring(index + keyword.length, index + keyword.length + 15);
              const numberMatch = afterKeyword.match(/^[\s\d\.\-\(\)]+/);
              if (numberMatch) {
                appText += numberMatch[0].trim();
              }
              appOccurrences.push({
                page: pageNum,
                text: appText.trim()
              });
              pageTexts[pageNum].hasApp = true;
              lastIndex = index + 1;
            }
          }
        } catch (error) {
          console.warn(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${pageNum}:`, error);
        }
      }
    }

    async function showCoverPage(pdf) {
      try {
        const page = await pdf.getPage(1);
        const textContent = await page.getTextContent();
        const items = textContent.items;
        items.sort((a, b) => {
          const yDiff = Math.round(a.transform[5]) - Math.round(b.transform[5]);
          if (yDiff !== 0) return yDiff;
          return a.transform[4] - b.transform[4];
        });

        let currentY = null;
        let textLines = [];
        let currentLine = [];
        items.forEach(item => {
          const y = Math.round(item.transform[5]);
          if (currentY === null) {
            currentY = y;
          }
          if (Math.abs(y - currentY) > 5) {
            textLines.push(currentLine.join(' '));
            currentLine = [];
            currentY = y;
          }
          currentLine.push(item.str);
        });
        if (currentLine.length > 0) {
          textLines.push(currentLine.join(' '));
        }

        const coverText = textLines.join('\n');
        document.getElementById('coverContent').textContent = coverText;
        // document.getElementById('coverWords').textContent = coverText.split(/\s+/).filter(word => word.length > 0).length;
        // document.getElementById('coverSection').style.display = 'block';

        if (pageTexts[1]) {
          pageTexts[1].isCover = true;
        }
      } catch (error) {
        console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–∏—Ç—É–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞:', error);
        document.getElementById('coverContent').textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∏—Ç—É–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞.';
        document.getElementById('coverSection').style.display = 'block';
      }
    }

    async function renderAllPages(pdf) {
      const container = document.getElementById('pagesContainer');
      container.innerHTML = '';
      
      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        await renderPage(pdf, pageNum);
      }
    }

    async function renderPage(pdf, pageNum) {
  const pageContainer = document.createElement('div');
  pageContainer.className = 'page-card collapsed';
  pageContainer.id = `page-${pageNum}`;
  pageContainer.dataset.pageNumber = pageNum;

  const pageHeader = document.createElement('div');
  pageHeader.className = 'page-header';

  const pageNumberDiv = document.createElement('div');
  pageNumberDiv.className = 'page-number';
  pageNumberDiv.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pageNum}`;

  const actionsDiv = document.createElement('div');
  actionsDiv.className = 'page-actions';

  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.className = 'page-checkbox';
  checkbox.id = `checkbox-${pageNum}`;
  checkbox.checked = selectedPages.has(pageNum);
  checkbox.onchange = function() {
    handleCheckboxChange(pageNum, this);
  };

  actionsDiv.appendChild(checkbox);
  pageHeader.appendChild(pageNumberDiv);
  pageHeader.appendChild(actionsDiv);
  pageContainer.appendChild(pageHeader);

  const tagsDiv = document.createElement('div');
  tagsDiv.className = 'page-tags';

  const textTag = document.createElement('span');
  textTag.className = 'tag tag-text';
  textTag.textContent = '–¢–µ–∫—Å—Ç';
  textTag.onclick = function() {
    togglePageContent(pageNum, 'text');
  };
  tagsDiv.appendChild(textTag);

  if (pageTexts[pageNum] && pageTexts[pageNum].hasTable) {
    const tableTag = document.createElement('span');
    tableTag.className = 'tag tag-table';
    tableTag.textContent = '–¢–∞–±–ª–∏—Ü–∞';
    tableTag.onclick = function() {
      togglePageContent(pageNum, 'table');
    };
    tagsDiv.appendChild(tableTag);
  }

  if (pageTexts[pageNum] && pageTexts[pageNum].hasApp) {
    const appTag = document.createElement('span');
    appTag.className = 'tag tag-app';
    appTag.textContent = '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
    appTag.onclick = function() {
      togglePageContent(pageNum, 'app');
    };
    tagsDiv.appendChild(appTag);
  }

  pageContainer.appendChild(tagsDiv);

  // ‚ûï –ò–ù–ü–£–¢ –ü–†–Ø–ú–û –ü–û–î –¢–ï–ì–ê–ú–ò, –í–ù–£–¢–†–ò –ö–ê–†–¢–û–ß–ö–ò
  const inputDiv = document.createElement('div');
  inputDiv.style.marginTop = '12px';
  const inputEl = document.createElement('input');
  inputEl.type = 'text';
  inputEl.className = 'page-search-input';
  inputEl.placeholder = 'üîç –ù–∞–π—Ç–∏ —Å–ª–æ–≤–æ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ...';
  inputEl.oninput = function() {
    searchInPage(pageNum, this.value);
  };
  inputDiv.appendChild(inputEl);
  pageContainer.appendChild(inputDiv);

  const contentDiv = document.createElement('div');
  contentDiv.className = 'page-content';
  if (pageTexts[pageNum]) {
    contentDiv.innerHTML = pageTexts[pageNum].lines.map(line => `<p>${escapeHtml(line)}</p>`).join('');
  }
  pageTexts[pageNum].textElement = contentDiv;
  pageContainer.appendChild(contentDiv);

  const buttonsDiv = document.createElement('div');
  buttonsDiv.className = 'page-buttons';

  const downloadBtn = document.createElement('button');
  downloadBtn.className = 'btn-icon';
  downloadBtn.title = '–°–∫–∞—á–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É';
  downloadBtn.innerHTML = 'üìÑ';
  downloadBtn.onclick = function() { downloadSinglePagePdf(pageNum); };

  const viewOriginalBtn = document.createElement('button');
  viewOriginalBtn.className = 'btn-icon';
  viewOriginalBtn.title = '–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª PDF';
  viewOriginalBtn.innerHTML = 'üëÄ';
  viewOriginalBtn.onclick = function() { viewOriginalPdf(pageNum); };

  // const goToBtn = document.createElement('button');
  // goToBtn.className = 'btn-icon';
  // goToBtn.title = '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–∞–±–ª–∏—Ü–∞–º';
  // goToBtn.innerHTML = 'üîç';
  // goToBtn.onclick = function() {
  //   const pageTables = tableOccurrences.filter(t => t.page === pageNum);
  //   if (pageTables.length > 0) {
  //     flashElement(pageContainer);
  //     showStatus(`–ù–∞–π–¥–µ–Ω–æ ${pageTables.length} —Ç–∞–±–ª–∏—Ü –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ`);
  //     setTimeout(hideStatus, 3000);
  //   } else {
  //     showStatus('–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–∞–±–ª–∏—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
  //     setTimeout(hideStatus, 3000);
  //   }
  // };

  buttonsDiv.appendChild(downloadBtn);
  buttonsDiv.appendChild(viewOriginalBtn);
  // buttonsDiv.appendChild(goToBtn);
  pageContainer.appendChild(buttonsDiv);

  // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
  document.getElementById('pagesContainer').appendChild(pageContainer);

  // ‚ûï –ü–û–¢–û–ú ‚Äî –†–ï–ó–£–õ–¨–¢–ê–¢ –ü–û–ò–°–ö–ê ‚Äî –°–†–ê–ó–£ –ü–û–°–õ–ï –ö–ê–†–¢–û–ß–ö–ò
  const resultsDiv = document.createElement('div');
  resultsDiv.className = 'page-search-results';
  resultsDiv.id = `search-results-${pageNum}`;
  document.getElementById('pagesContainer').appendChild(resultsDiv);
}

//     async function renderPage(pdf, pageNum) {
//       const pageContainer = document.createElement('div');
//       pageContainer.className = 'page-card collapsed';
//       pageContainer.id = `page-${pageNum}`;
//       pageContainer.dataset.pageNumber = pageNum;

//       const pageHeader = document.createElement('div');
//       pageHeader.className = 'page-header';

//       const pageNumberDiv = document.createElement('div');
//       pageNumberDiv.className = 'page-number';
//       pageNumberDiv.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pageNum}`;

//       const actionsDiv = document.createElement('div');
//       actionsDiv.className = 'page-actions';

//       const checkbox = document.createElement('input');
//       checkbox.type = 'checkbox';
//       checkbox.className = 'page-checkbox';
//       checkbox.id = `checkbox-${pageNum}`;
//       checkbox.checked = selectedPages.has(pageNum);
//       checkbox.onchange = function() {
//         handleCheckboxChange(pageNum, this);
//       };

//       actionsDiv.appendChild(checkbox);
//       pageHeader.appendChild(pageNumberDiv);
//       pageHeader.appendChild(actionsDiv);
//       pageContainer.appendChild(pageHeader);

//       const tagsDiv = document.createElement('div');
//       tagsDiv.className = 'page-tags';

//       const textTag = document.createElement('span');
//       textTag.className = 'tag tag-text';
//       textTag.textContent = '–¢–µ–∫—Å—Ç';
//       textTag.onclick = function() {
//         togglePageContent(pageNum, 'text');
//       };
//       tagsDiv.appendChild(textTag);
      

//       if (pageTexts[pageNum] && pageTexts[pageNum].hasTable) {
//         const tableTag = document.createElement('span');
//         tableTag.className = 'tag tag-table';
//         tableTag.textContent = '–¢–∞–±–ª–∏—Ü–∞';
//         tableTag.onclick = function() {
//           togglePageContent(pageNum, 'table');
//         };
//         tagsDiv.appendChild(tableTag);
//       }

//       if (pageTexts[pageNum] && pageTexts[pageNum].hasApp) {
//         const appTag = document.createElement('span');
//         appTag.className = 'tag tag-app';
//         appTag.textContent = '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
//         appTag.onclick = function() {
//           togglePageContent(pageNum, 'app');
//         };
//         tagsDiv.appendChild(appTag);
//       }

//       pageContainer.appendChild(tagsDiv);

//       // –ò–Ω–ø—É—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏
// const inputDiv = document.createElement('div');
// inputDiv.innerHTML = `<input type="text" class="page-search-input" placeholder="–ù–∞–π—Ç–∏ —Å–ª–æ–≤–æ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ..." oninput="searchInPage(${pageNum}, this.value)">`;
// inputDiv.style.marginTop = '12px';
// pageContainer.appendChild(inputDiv);

// // –ê —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Å–Ω–∞—Ä—É–∂–∏, –ø–æ–¥ –∫–∞—Ä—Ç–æ—á–∫–æ–π
// const resultsDiv = document.createElement('div');
// resultsDiv.className = 'page-search-results';
// resultsDiv.id = `search-results-${pageNum}`;
// document.getElementById('pagesContainer').appendChild(resultsDiv);

// //       const searchBox = document.createElement('div');
// // searchBox.className = 'page-search-box';
// // searchBox.innerHTML = `
// //   <input type="text" class="page-search-input" placeholder="–ù–∞–π—Ç–∏ —Å–ª–æ–≤–æ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ..."
// //          oninput="searchInPage(${pageNum}, this.value)">
// //   <div class="page-search-results"></div>
// // `;
// // searchBox.style.marginTop = '12px';
// // pageContainer.appendChild(searchBox);

//       const contentDiv = document.createElement('div');
//       contentDiv.className = 'page-content';
//       if (pageTexts[pageNum]) {
//         contentDiv.innerHTML = pageTexts[pageNum].lines.map(line => `<p>${escapeHtml(line)}</p>`).join('');
//       }
//       pageTexts[pageNum].textElement = contentDiv;
//       pageContainer.appendChild(contentDiv);

//       const buttonsDiv = document.createElement('div');
//       buttonsDiv.className = 'page-buttons';

//       const downloadBtn = document.createElement('button');
// downloadBtn.className = 'btn-icon';
// downloadBtn.title = '–°–∫–∞—á–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É';
// downloadBtn.innerHTML = 'üìÑ';
// downloadBtn.onclick = function() { downloadSinglePagePdf(pageNum); };

// const viewOriginalBtn = document.createElement('button');
// viewOriginalBtn.className = 'btn-icon';
// viewOriginalBtn.title = '–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª PDF';
// viewOriginalBtn.innerHTML = 'üëÄ';
// viewOriginalBtn.onclick = function() { viewOriginalPdf(pageNum); };

// const goToBtn = document.createElement('button');
// goToBtn.className = 'btn-icon';
// goToBtn.title = '–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–∞–±–ª–∏—Ü–∞–º';
// goToBtn.innerHTML = 'üîç';
// goToBtn.onclick = function() {
//   const pageTables = tableOccurrences.filter(t => t.page === pageNum);
//   if (pageTables.length > 0) {
//     flashElement(pageContainer);
//     showStatus(`–ù–∞–π–¥–µ–Ω–æ ${pageTables.length} —Ç–∞–±–ª–∏—Ü –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ`);
//     setTimeout(hideStatus, 3000);
//   } else {
//     showStatus('–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–∞–±–ª–∏—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
//     setTimeout(hideStatus, 3000);
//   }
// };

//       buttonsDiv.appendChild(downloadBtn);
//       buttonsDiv.appendChild(viewOriginalBtn);
//       buttonsDiv.appendChild(goToBtn);
//       pageContainer.appendChild(buttonsDiv);

//       document.getElementById('pagesContainer').appendChild(pageContainer);
//     }

    function togglePageContent(pageNum, type) {
      const pageCard = document.getElementById(`page-${pageNum}`);
      const contentDiv = pageCard.querySelector('.page-content');
      if (contentDiv.classList.contains('active')) {
        contentDiv.classList.remove('active');
        pageCard.classList.remove('expanded');
        pageCard.classList.add('collapsed');
      } else {
        contentDiv.classList.add('active');
        pageCard.classList.remove('collapsed');
        pageCard.classList.add('expanded');
      }
      const tag = pageCard.querySelector(`.tag-${type}`);
      if (tag) {
        tag.classList.add('active');
        setTimeout(() => tag.classList.remove('active'), 1000);
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function handleCheckboxChange(pageNum, checkbox) {
      if (checkbox.checked) {
        selectedPages.add(pageNum);
      } else {
        selectedPages.delete(pageNum);
      }
      const container = document.getElementById(`page-${pageNum}`);
      if (container) {
        container.classList.toggle('checked', checkbox.checked);
      }
      updateSelectedCount();
    }

    function updateSelectedCount() {
      const count = selectedPages.size;
      const countElement = document.getElementById('selectedCount');
      countElement.textContent = count > 0 ? `–í—ã–±—Ä–∞–Ω–æ: ${count}` : '';
    }

    function toggleToolbar() {
      const content = document.getElementById('toolbarContent');
      content.classList.toggle('active');
    }

    function toggleMagicPanel() {
      const panel = document.getElementById('magicPanel');
      panel.classList.toggle('collapsed');
    }

    function goToPage() {
      const pageNumber = parseInt(document.getElementById('pageNumberInput').value);
      if (isNaN(pageNumber) || pageNumber < 1 || pageNumber > totalPages) {
        alert(`–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (1-${totalPages})`);
        return;
      }
      const targetElement = document.getElementById(`page-${pageNumber}`);
      if (targetElement) {
        targetElement.scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
        flashElement(targetElement);
        showStatus(`–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ${pageNumber}`);
        setTimeout(hideStatus, 2000);
      }
    }

    function flashElement(element) {
      element.classList.add('highlighted');
      setTimeout(() => {
        element.classList.remove('highlighted');
      }, 2000);
    }

    function selectRange() {
      const from = parseInt(document.getElementById('rangeFrom').value);
      const to = parseInt(document.getElementById('rangeTo').value);
      if (isNaN(from) || isNaN(to) || from < 1 || to < 1 || from > totalPages || to > totalPages || from > to) {
        alert(`–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (1-${totalPages})`);
        return;
      }
      for (let i = from; i <= to; i++) {
        selectedPages.add(i);
        const checkbox = document.getElementById(`checkbox-${i}`);
        if (checkbox) {
          checkbox.checked = true;
          const container = document.getElementById(`page-${i}`);
          if (container) container.classList.add('checked');
        }
      }
      updateSelectedCount();
      showStatus(`–í—ã–±—Ä–∞–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü: ${to - from + 1} (—Å—Ç—Ä–∞–Ω–∏—Ü—ã ${from}-${to})`);
      setTimeout(hideStatus, 3000);
    }

    function selectAllPages() {
      selectedPages.clear();
      for (let i = 1; i <= totalPages; i++) {
        selectedPages.add(i);
        const checkbox = document.getElementById(`checkbox-${i}`);
        if (checkbox) {
          checkbox.checked = true;
          const container = document.getElementById(`page-${i}`);
          if (container) container.classList.add('checked');
        }
      }
      updateSelectedCount();
      showStatus(`–í—ã–±—Ä–∞–Ω—ã –≤—Å–µ ${totalPages} —Å—Ç—Ä–∞–Ω–∏—Ü`);
      setTimeout(hideStatus, 3000);
    }

    function deselectAllPages() {
      selectedPages.clear();
      for (let i = 1; i <= totalPages; i++) {
        const checkbox = document.getElementById(`checkbox-${i}`);
        if (checkbox) {
          checkbox.checked = false;
          const container = document.getElementById(`page-${i}`);
          if (container) container.classList.remove('checked');
        }
      }
      updateSelectedCount();
      showStatus('–í—Å–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å–Ω—è—Ç—ã');
      setTimeout(hideStatus, 3000);
    }

    async function downloadSinglePagePdf(pageNumber) {
  if (!document.getElementById('pdfFile').files[0]) {
    alert('–§–∞–π–ª –±—ã–ª –∑–∞–∫—Ä—ã—Ç –∏–ª–∏ —É–¥–∞–ª—ë–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∑–∞–Ω–æ–≤–æ.');
    return;
  }
  showStatus('–ì–æ—Ç–æ–≤–∏–º PDF —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è...');
  try {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js';
    script.onload = async function() {
      try {
        const { PDFDocument } = window.PDFLib;
        // ‚úÖ –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∑–∞–Ω–æ–≤–æ ‚Äî –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º originalFileArrayBuffer!
        const file = document.getElementById('pdfFile').files[0];
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFDocument.load(arrayBuffer);
        const newPdfDoc = await PDFDocument.create();
        const [copiedPage] = await newPdfDoc.copyPages(pdfDoc, [pageNumber - 1]);
        newPdfDoc.addPage(copiedPage);
        const pdfBytes = await newPdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const link = document.createElement('a');
        link.download = `–°—Ç—Ä–∞–Ω–∏—Ü–∞_${pageNumber}_${document.getElementById('fileName').textContent}.pdf`;
        link.href = URL.createObjectURL(blob);
        link.click();
        hideStatus();
        showStatus('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω–∞! üéâ');
        setTimeout(hideStatus, 3000);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF:', error);
        hideStatus();
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å PDF. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
      }
    };
    script.onerror = () => {
      hideStatus();
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É PDF-LIB');
    };
    document.head.appendChild(script);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error);
    hideStatus();
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ PDF');
  }
}

  
    async function downloadSelectedPdfPages() {
  if (selectedPages.size === 0) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—É');
    return;
  }
  if (!document.getElementById('pdfFile').files[0]) {
    alert('–§–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –í—ã–±–µ—Ä–∏—Ç–µ PDF –∑–∞–Ω–æ–≤–æ.');
    return;
  }
  showStatus(`–°–æ–∑–¥–∞—ë–º PDF –∏–∑ ${selectedPages.size} —Å—Ç—Ä–∞–Ω–∏—Ü...`);
  try {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js';
    script.onload = async function() {
      try {
        const { PDFDocument } = window.PDFLib;
        const file = document.getElementById('pdfFile').files[0];
        const arrayBuffer = await file.arrayBuffer();
        const originalPdf = await PDFDocument.load(arrayBuffer);
        const newPdfDoc = await PDFDocument.create();
        const sortedSelected = Array.from(selectedPages).sort((a, b) => a - b);
        for (const pageNum of sortedSelected) {
          const [copiedPage] = await newPdfDoc.copyPages(originalPdf, [pageNum - 1]);
          newPdfDoc.addPage(copiedPage);
        }
        const pdfBytes = await newPdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const link = document.createElement('a');
        link.download = `–í—ã–±—Ä–∞–Ω–Ω—ã–µ_—Å—Ç—Ä–∞–Ω–∏—Ü—ã_${document.getElementById('fileName').textContent}.pdf`;
        link.href = URL.createObjectURL(blob);
        link.click();
        hideStatus();
        showStatus('PDF —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω! üöÄ');
        setTimeout(hideStatus, 3000);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF:', error);
        hideStatus();
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å PDF. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
      }
    };
    script.onerror = () => {
      hideStatus();
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å PDF-LIB');
    };
    document.head.appendChild(script);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error);
    hideStatus();
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF');
  }
}  

    async function viewOriginalPdf(startPage) {
  if (!pdfDocument) {
    alert('PDF –¥–æ–∫—É–º–µ–Ω—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω.');
    return;
  }

  showStatus('–†–µ–Ω–¥–µ—Ä–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É PDF...');

  try {
    // –ü–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É PDF
    const page = await pdfDocument.getPage(startPage);
    
    // –°–æ–∑–¥–∞–µ–º viewport —Å —Ö–æ—Ä–æ—à–∏–º –º–∞—Å—à—Ç–∞–±–æ–º
    const viewport = page.getViewport({ scale: 1.5 });
    
    // –°–æ–∑–¥–∞–µ–º canvas
    const canvas = document.createElement('canvas');
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    canvas.style.width = '100%';
    canvas.style.height = 'auto';
    canvas.style.maxWidth = '100%';
    canvas.style.borderRadius = '8px';

    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
    const renderContext = {
      canvasContext: canvas.getContext('2d'),
      viewport: viewport
    };

    await page.render(renderContext).promise;

    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = document.createElement('div');
    modal.id = 'pdfModal';
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100vw';
    modal.style.height = '100vh';
    modal.style.backgroundColor = 'rgba(0,0,0,0.85)';
    modal.style.zIndex = '2000';
    modal.style.display = 'flex';
    modal.style.justifyContent = 'center';
    modal.style.alignItems = 'center';
    modal.style.padding = '20px';
    modal.style.boxSizing = 'border-box';
    modal.style.overflow = 'auto';

    // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è canvas
    const container = document.createElement('div');
    container.style.position = 'relative';
    container.style.maxWidth = '1200px';
    container.style.maxHeight = '90vh';
    container.style.backgroundColor = 'white';
    container.style.borderRadius = '8px';
    container.style.overflow = 'auto';
    container.style.padding = '20px';

    // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    const closeBtn = document.createElement('button');
    closeBtn.innerHTML = '‚úñÔ∏è –ó–∞–∫—Ä—ã—Ç—å (Esc)';
    closeBtn.style.position = 'absolute';
    closeBtn.style.top = '10px';
    closeBtn.style.right = '10px';
    closeBtn.style.zIndex = '2001';
    closeBtn.style.padding = '8px 16px';
    closeBtn.style.backgroundColor = '#e91e63';
    closeBtn.style.color = 'white';
    closeBtn.style.border = 'none';
    closeBtn.style.borderRadius = '4px';
    closeBtn.style.cursor = 'pointer';
    closeBtn.style.fontSize = '14px';
    closeBtn.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
    closeBtn.onclick = function() {
      closeModal();
    };

    // –î–æ–±–∞–≤–ª—è–µ–º canvas –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    container.appendChild(closeBtn);
    container.appendChild(canvas);
    modal.appendChild(container);
    document.body.appendChild(modal);

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
    function closeModal() {
      if (modal.parentNode) {
        document.body.removeChild(modal);
      }
      hideStatus();
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Esc
    const handleEsc = function(e) {
      if (e.key === 'Escape') {
        closeModal();
        document.removeEventListener('keydown', handleEsc);
      }
    };
    document.addEventListener('keydown', handleEsc);

    hideStatus();
    showStatus(`–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${startPage} —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–∞!`);
    setTimeout(hideStatus, 3000);

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ PDF:', error);
    hideStatus();
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É PDF. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
  }
}
    

//     function updateTableList() {
//   const container = document.getElementById('tablesContainer');
//   if (!container) {
//     console.warn('–≠–ª–µ–º–µ–Ω—Ç tablesContainer –Ω–µ –Ω–∞–π–¥–µ–Ω');
//     return;
//   }
//   container.innerHTML = '';
//   if (tableOccurrences.length === 0) {
//     container.innerHTML = '<p>–¢–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
//     return;
//   }
//   tableOccurrences.forEach((item, index) => {
//   // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã + –ø–ª–∞—à–∫–∏
//   const wrapper = document.createElement('div');
//   wrapper.style.display = 'flex';
//   wrapper.style.flexDirection = 'column';
//   wrapper.style.alignItems = 'center';
//   wrapper.style.gap = '4px'; // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –Ω–æ–º–µ—Ä–æ–º –∏ –ø–ª–∞—à–∫–æ–π

//   // –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
//   const pageNumEl = document.createElement('div');
//   pageNumEl.className = 'table-page-number';
//   pageNumEl.textContent = `–°—Ç—Ä. ${item.page}`;
  
//   // –ü–ª–∞—à–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
//   const tag = document.createElement('span');
//   tag.className = 'table-tag';
//   tag.textContent = item.text;
//   tag.title = `–°—Ç—Ä. ${item.page}`;
//   tag.dataset.page = item.page;

//   // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –ª–æ–≥–∏–∫—É –≤ tag (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–∞, –Ω–æ –≤–Ω—É—Ç—Ä–∏ wrapper)
//   tag.onmouseenter = function() {
//     this.style.width = 'auto';
//     this.innerHTML = `${item.text} <span class="table-preview-trigger">üëÄ</span>`;
//     const trigger = this.querySelector('.table-preview-trigger');
//     if (trigger) {
//       trigger.onclick = function(e) {
//         e.stopPropagation();
//         createTablePreviewTooltip(trigger, item.page);
//       };
//       trigger.onmouseenter = () => {
//         createTablePreviewTooltip(trigger, item.page);
//       };
//       trigger.onmouseleave = () => {
//         const tooltip = document.querySelector('.table-preview-tooltip');
//         if (tooltip) tooltip.remove();
//       };
//     }
//   };

//   tag.onmouseleave = function() {
//     this.innerHTML = item.text;
//     const tooltip = document.querySelector('.table-preview-tooltip');
//     if (tooltip) tooltip.remove();
//   };

//   // tag.onclick = () => {
//   //   document.getElementById('pageNumberInput').value = item.page;
//   //   goToPage();
//   //   const pageCard = document.getElementById(`page-${item.page}`);
//   //   if (pageCard) {
//   //     flashElement(pageCard);
//   //   }
//   //   tag.classList.add('active');
//   //   setTimeout(() => {
//   //     tag.classList.remove('active');
//   //   }, 2000);
//   // };

//   // –°–æ–±–∏—Ä–∞–µ–º
//   wrapper.appendChild(pageNumEl);
//   wrapper.appendChild(tag);
//   container.appendChild(wrapper);
// });

  
// }

function updateTableList() {
  const container = document.getElementById('tablesContainer');
  if (!container) return;
  container.innerHTML = '';
  if (tableOccurrences.length === 0) {
    container.innerHTML = '<p>–¢–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
    return;
  }

  tableOccurrences.forEach((item) => {
    const wrapper = document.createElement('span');
    wrapper.className = 'table-tag';
    wrapper.style.display = 'inline-flex';
    wrapper.style.flexDirection = 'column';
    wrapper.style.alignItems = 'center';
    wrapper.style.gap = '4px'; // —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –Ω–æ–º–µ—Ä–æ–º –∏ —Ç–µ–∫—Å—Ç–æ–º
    wrapper.style.padding = '6px 12px'; // –∫–∞–∫ —É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ .table-tag
    wrapper.style.borderRadius = '3px';
    wrapper.style.fontSize = '13px';
    wrapper.style.fontWeight = '500';
    wrapper.style.cursor = 'pointer';
    // wrapper.style.border = '2px solid #fdd835';
    // wrapper.style.background = '#ffeb3b';
    // wrapper.style.color = '#333';
    wrapper.style.transition = 'all 0.3s';
    wrapper.title = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${item.page}`;

    const pageNum = document.createElement('span');
    pageNum.style.fontSize = '11px';
    pageNum.style.color = '#777';
    pageNum.textContent = `–°—Ç—Ä. ${item.page}`;

    const labelText = document.createElement('span');
    labelText.textContent = item.text;

    wrapper.appendChild(pageNum);
    wrapper.appendChild(labelText);

    wrapper.onclick = () => {
      document.getElementById('pageNumberInput').value = item.page;
      goToPage();
      const pageCard = document.getElementById(`page-${item.page}`);
      if (pageCard) flashElement(pageCard);
      wrapper.classList.add('active');
      setTimeout(() => wrapper.classList.remove('active'), 1000);
    };

    wrapper.onmouseenter = () => {
      wrapper.style.transform = 'scale(1.08)';
      wrapper.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
    };
    wrapper.onmouseleave = () => {
      wrapper.style.transform = '';
      wrapper.style.boxShadow = '';
    };

    container.appendChild(wrapper);
  });
}
// function updateTableList() {
//   const container = document.getElementById('tablesContainer');
//   if (!container) {
//     console.warn('–≠–ª–µ–º–µ–Ω—Ç tablesContainer –Ω–µ –Ω–∞–π–¥–µ–Ω');
//     return;
//   }
//   container.innerHTML = '';
//   if (tableOccurrences.length === 0) {
//     container.innerHTML = '<p>–¢–∞–±–ª–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
//     return;
//   }
//   tableOccurrences.forEach((item) => {
//     const tag = document.createElement('span');
//     tag.className = 'table-tag';
//     tag.textContent = item.text;
//     tag.title = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${item.page}`; // –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
//     tag.onclick = () => {
//       document.getElementById('pageNumberInput').value = item.page;
//       goToPage();
//       const pageCard = document.getElementById(`page-${item.page}`);
//       if (pageCard) {
//         flashElement(pageCard);
//       }
//       tag.classList.add('active');
//       setTimeout(() => tag.classList.remove('active'), 2000);
//     };
//     container.appendChild(tag);
//   });
// }

    function updateAppList() {
      // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞
      const container = document.getElementById('appsContainer');
      if (!container) {
        console.warn('–≠–ª–µ–º–µ–Ω—Ç appsContainer –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }
      
      container.innerHTML = '';
      if (appOccurrences.length === 0) {
        container.innerHTML = '<p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
        return;
      }
      
      appOccurrences.forEach((item, index) => {
        const tag = document.createElement('span');
        tag.className = 'app-tag';
        tag.textContent = item.text;
        tag.title = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${item.page}`;
        tag.onclick = () => {
          document.getElementById('pageNumberInput').value = item.page;
          goToPage();
          const pageCard = document.getElementById(`page-${item.page}`);
          if (pageCard) {
            flashElement(pageCard);
          }
          tag.classList.add('active');
          setTimeout(() => {
            tag.classList.remove('active');
          }, 2000);
        };
        container.appendChild(tag);
      });
    }

//     function createTablePreviewTooltip(tagElement, pageNum) {
//   const existing = document.querySelector('.table-preview-tooltip');
//   if (existing) {
//     existing.remove();
//   }

//   const tooltip = document.createElement('div');
//   tooltip.className = 'table-preview-tooltip';

//   // –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
//   const goToLink = document.createElement('a');
//   goToLink.href = '#';
//   goToLink.textContent = '‚ÜóÔ∏è –ü–µ—Ä–µ–π—Ç–∏';
//   goToLink.style.position = 'absolute';
//   goToLink.style.top = '8px';
//   goToLink.style.right = '10px';
//   goToLink.style.fontSize = '12px';
//   goToLink.style.color = '#e91e63';
//   goToLink.style.textDecoration = 'none';
//   goToLink.style.fontWeight = 'bold';
//   goToLink.style.zIndex = '1002';
//   goToLink.onclick = function(e) {
//     e.preventDefault();
//     e.stopPropagation();
//     document.getElementById('pageNumberInput').value = pageNum;
//     goToPage();
//     const pageCard = document.getElementById(`page-${pageNum}`);
//     if (pageCard) {
//       flashElement(pageCard);
//     }
//     tooltip.remove(); // –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞
//   };
//   tooltip.appendChild(goToLink);

//   const pageData = pageTexts[pageNum];
//   if (!pageData || !pageData.lines) {
//     tooltip.innerHTML += '<div style="padding-top:20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
//     tagElement.appendChild(tooltip);
//     setTimeout(() => tooltip.classList.add('active'), 10);
//     return;
//   }

//   let previewText = '';
//   const sampleLines = pageData.lines.slice(0, 10);
//   for (let line of sampleLines) {
//     const words = line.split(' ');
//     for (let word of words) {
//       if (word.length > 0) {
//         if (/\d/.test(word) || (word === word.toUpperCase() && word.length > 1 && !/\d/.test(word))) {
//           previewText += `<span class="preview-highlight">${escapeHtml(word)}</span> `;
//         } else {
//           previewText += escapeHtml(word) + ' ';
//         }
//       }
//     }
//     previewText += '<br>';
//   }

//   const contentDiv = document.createElement('div');
//   contentDiv.style.paddingTop = '20px';
//   contentDiv.innerHTML = previewText || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–≤—å—é';
//   tooltip.appendChild(contentDiv);

//   tagElement.appendChild(tooltip);
//   setTimeout(() => tooltip.classList.add('active'), 10);
// }

    function performGlobalSearch() {
      const keyword = document.getElementById('globalSearchInput').value.trim();
      if (!keyword) {
        alert('–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞');
        return;
      }
      clearSearchResults();
      globalSearchResults = [];
      let totalFound = 0;
      for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
        const pageData = pageTexts[pageNum];
        if (!pageData || !pageData.lines) continue;
        pageData.lines.forEach((line, lineIndex) => {
          if (line.includes(keyword)) {
            globalSearchResults.push({
              page: pageNum,
              word: keyword,
              line: lineIndex + 1
            });
            totalFound++;
          }
        });
      }
      document.getElementById('searchResultsCount').textContent = `${totalFound} —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π`;
      const resultsContainer = document.getElementById('globalSearchResults');
      globalSearchResults.forEach(result => {
        const tag = document.createElement('span');
        tag.className = 'search-tag';
        tag.innerHTML = `${result.word}<br><small>–°—Ç—Ä. ${result.page}</small>`;
        tag.onclick = () => {
          document.getElementById('pageNumberInput').value = result.page;
          goToPage();
          highlightSearchResult(result.page, result.word);
        };
        resultsContainer.appendChild(tag);
      });
      if (totalFound > 0) {
        showStatus(`–ù–∞–π–¥–µ–Ω–æ ${totalFound} —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –¥–ª—è "${keyword}"`);
      } else {
        showStatus(`–°–ª–æ–≤–æ "${keyword}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ`);
      }
      setTimeout(hideStatus, 3000);
    }

    function clearSearchResults() {
      document.getElementById('globalSearchResults').innerHTML = '';
      document.getElementById('searchResultsCount').textContent = '';
    }

    function highlightSearchResult(pageNum, keyword) {
      const pageCard = document.getElementById(`page-${pageNum}`);
      if (!pageCard) return;
      const contentDiv = pageCard.querySelector('.page-content');
      if (!contentDiv.classList.contains('active')) {
        togglePageContent(pageNum, 'text');
      }
      const paragraphs = contentDiv.querySelectorAll('p');
      paragraphs.forEach(p => {
        if (p.textContent.includes(keyword)) {
          const regex = new RegExp(`(${escapeRegExp(keyword)})`, 'gi');
          p.innerHTML = p.innerHTML.replace(regex, `<span class="magic-purple-bg">$1</span>`);
        }
      });
      flashElement(pageCard);
    }

    function applyCollapseText() {
      const keyword = document.getElementById('collapseKeyword').value.trim();
      const linesToHide = parseInt(document.getElementById('collapseLines').value) || 5;
      if (!keyword) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞');
        return;
      }
      showStatus(`–ú–∞–≥–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º ${linesToHide} —Å—Ç—Ä–æ–∫ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ "${keyword}"...`);
      let totalAffected = 0;
      for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
        const textData = pageTexts[pageNum];
        if (!textData || !textData.textElement) continue;
        const paragraphs = textData.textElement.querySelectorAll('p');
        let found = false;
        for (let i = 0; i < paragraphs.length; i++) {
          if (paragraphs[i].textContent.includes(keyword)) {
            found = true;
            totalAffected++;
            const regex = new RegExp(`(${escapeRegExp(keyword)})`, 'gi');
            paragraphs[i].innerHTML = paragraphs[i].innerHTML.replace(regex, `<span class="magic-green-bg">$1</span>`);
            for (let j = 1; j <= linesToHide; j++) {
              if (i + j < paragraphs.length) {
                paragraphs[i + j].classList.add('hidden-text');
                if (j === linesToHide) {
                  paragraphs[i + j].classList.add('magic-collapse-end');
                }
              }
            }
          }
        }
        if (found) {
          flashElement(document.getElementById(`page-${pageNum}`));
        }
      }
      setTimeout(() => {
        hideStatus();
        if (totalAffected > 0) {
          showStatus(`–ú–∞–≥–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞! –ó–∞—Ç—Ä–æ–Ω—É—Ç–æ ${totalAffected} –º–µ—Å—Ç.`);
          setTimeout(hideStatus, 3000);
        } else {
          alert(`–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "${keyword}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ.`);
        }
      }, 1000);
    }

    function applyColorText() {
      const keyword = document.getElementById('colorKeyword').value.trim();
      const color = document.getElementById('colorPicker').value;
      if (!keyword) {
        alert('–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –¥–ª—è —Ä–∞—Å–∫—Ä–∞—Å–∫–∏');
        return;
      }
      showStatus(`–†–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ–º –≤—Å–µ "${keyword}" –≤ —Ü–≤–µ—Ç ${color}...`);
      let totalColored = 0;
      for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
        const textData = pageTexts[pageNum];
        if (!textData || !textData.textElement) continue;
        const paragraphs = textData.textElement.querySelectorAll('p');
        let found = false;
        paragraphs.forEach(p => {
          if (p.textContent.includes(keyword)) {
            found = true;
            const regex = new RegExp(`(${escapeRegExp(keyword)})`, 'gi');
            p.innerHTML = p.innerHTML.replace(regex, `<span style="background-color: ${color}; padding: 2px 4px; border-radius: 3px; font-weight: bold; border: 1px solid ${color};">$1</span>`);
          }
        });
        if (found) {
          totalColored++;
          flashElement(document.getElementById(`page-${pageNum}`));
        }
      }
      setTimeout(() => {
        hideStatus();
        if (totalColored > 0) {
          showStatus(`–†–∞—Å–∫—Ä–∞—à–µ–Ω–æ ${totalColored} —Å—Ç—Ä–∞–Ω–∏—Ü!`);
          setTimeout(hideStatus, 3000);
        } else {
          alert(`–°–ª–æ–≤–æ "${keyword}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ.`);
        }
      }, 1000);
    }

    function applyFilterText() {
      const keyword = document.getElementById('filterKeyword').value.trim();
      const linesToShow = parseInt(document.getElementById('filterLines').value) || 3;
      if (!keyword) {
        alert('–í–≤–µ–¥–∏—Ç–µ –º–∞–≥–∏—á–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏');
        return;
      }
      showStatus(`–§–∏–ª—å—Ç—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç! –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏ —Å "${keyword}" –∏ ${linesToShow} —Å—Ç—Ä–æ–∫ –ø–æ—Å–ª–µ...`);
      let totalFiltered = 0;
      const pagesContainer = document.getElementById('pagesContainer');
      for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
        const pageCard = document.getElementById(`page-${pageNum}`);
        pageCard.classList.remove('mini');
        pageCard.style.position = 'relative';
      }
      for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
        const textData = pageTexts[pageNum];
        if (!textData || !textData.textElement) continue;
        const paragraphs = Array.from(textData.textElement.querySelectorAll('p'));
        let found = false;
        paragraphs.forEach(p => p.classList.add('hidden-text'));
        for (let i = 0; i < paragraphs.length; i++) {
          if (paragraphs[i].textContent.includes(keyword)) {
            found = true;
            totalFiltered++;
            const regex = new RegExp(`(${escapeRegExp(keyword)})`, 'gi');
            paragraphs[i].innerHTML = paragraphs[i].innerHTML.replace(regex, `<span class="magic-purple-bg">$1</span>`);
            for (let j = 0; j <= linesToShow; j++) {
              if (i + j < paragraphs.length) {
                paragraphs[i + j].classList.remove('hidden-text');
              }
            }
          }
        }
        const pageCard = document.getElementById(`page-${pageNum}`);
        if (found) {
          flashElement(pageCard);
          const contentDiv = pageCard.querySelector('.page-content');
          if (!contentDiv.classList.contains('active')) {
            togglePageContent(pageNum, 'text');
          }
        } else {
          pageCard.classList.add('mini');
          pageCard.style.position = 'absolute';
          const containerRect = pagesContainer.getBoundingClientRect();
          pageCard.style.right = '20px';
          pageCard.style.bottom = `${20 + (totalPages - pageNum) * 25}px`;
        }
      }
      setTimeout(() => {
        hideStatus();
        if (totalFiltered > 0) {
          showStatus(`–§–∏–ª—å—Ç—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω! –ù–∞–π–¥–µ–Ω–æ ${totalFiltered} –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Å—Ç.`);
          setTimeout(hideStatus, 3000);
        } else {
          alert(`–ú–∞–≥–∏—á–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ "${keyword}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ.`);
        }
      }, 1000);
    }

    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function showStatus(message) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.style.display = 'block';
    }

    function hideStatus() {
      document.getElementById('status').style.display = 'none';
    }

    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'g') {
        e.preventDefault();
        document.getElementById('pageNumberInput').focus();
      }
      if (e.ctrlKey && e.key === 'a' && !e.target.isContentEditable && e.target.tagName !== 'INPUT') {
        e.preventDefault();
        selectAllPages();
      }
      if (e.ctrlKey && e.key === 'm') {
        e.preventDefault();
        toggleMagicPanel();
      }
      if (e.ctrlKey && e.key === 'f') {
        e.preventDefault();
        document.getElementById('globalSearchInput').focus();
      }
    });

    (async function loadPDFLib() {
      try {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js';
        script.onload = function() {
          console.log('PDFLib loaded');
        };
        script.onerror = function() {
          console.error('Failed to load PDFLib');
        };
        document.head.appendChild(script);
      } catch (error) {
        console.error('Error loading PDFLib:', error);
      }
    })();
  
    function searchInPage(pageNum, query) {
  const resultsDiv = document.getElementById(`search-results-${pageNum}`);
  if (!resultsDiv) return;

  if (!query.trim()) {
    resultsDiv.classList.remove('active');
    return;
  }

  const pageData = pageTexts[pageNum];
  if (!pageData || !pageData.lines) {
    resultsDiv.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
    resultsDiv.classList.add('active');
    return;
  }

  const matches = [];
  const q = query.trim().toLowerCase();

  for (const line of pageData.lines) {
    if (line.toLowerCase().includes(q)) {
      const escaped = escapeHtml(line);
      const highlighted = escaped.replace(
        new RegExp(`(${escapeRegExp(query)})`, 'gi'),
        '<mark>$1</mark>'
      );
      matches.push(`<p>${highlighted}</p>`);
    }
  }

  if (matches.length > 0) {
    resultsDiv.innerHTML = matches.join('');
  } else {
    resultsDiv.innerHTML = '<p>–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
  }
  resultsDiv.classList.add('active');
}


//     function searchInPage(pageNum, query) {
//   const resultsDiv = document.getElementById(`search-results-${pageNum}`);
//   if (!resultsDiv) return;

//   if (!query.trim()) {
//     resultsDiv.style.display = 'none';
//     return;
//   }

//   const pageData = pageTexts[pageNum];
//   if (!pageData || !pageData.lines) {
//     resultsDiv.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
//     resultsDiv.style.display = 'block';
//     return;
//   }

//   const matches = [];
//   const q = query.trim().toLowerCase();

//   for (const line of pageData.lines) {
//     if (line.toLowerCase().includes(q)) {
//       const escaped = escapeHtml(line);
//       const highlighted = escaped.replace(
//         new RegExp(`(${escapeRegExp(query)})`, 'gi'),
//         '<mark style="background:#ffeb3b;color:#333;padding:0 3px;border-radius:3px;">$1</mark>'
//       );
//       matches.push(`<p style="margin:6px 0;line-height:1.5;">${highlighted}</p>`);
//     }
//   }

//   if (matches.length > 0) {
//     resultsDiv.innerHTML = matches.join('');
//   } else {
//     resultsDiv.innerHTML = '<p>–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
//   }
//   resultsDiv.style.display = 'block';
// }

//     function searchInPage(pageNum, query) {
//   const resultsDiv = document.querySelector(`#page-${pageNum} .page-search-results`);
//   if (!resultsDiv) return;

//   if (!query.trim()) {
//     resultsDiv.classList.remove('active');
//     return;
//   }

//   const pageData = pageTexts[pageNum];
//   if (!pageData || !pageData.lines) {
//     resultsDiv.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
//     resultsDiv.classList.add('active');
//     return;
//   }

//   const matches = [];
//   const q = query.trim().toLowerCase();

//   for (const line of pageData.lines) {
//     if (line.toLowerCase().includes(q)) {
//       const escaped = escapeHtml(line);
//       const highlighted = escaped.replace(
//         new RegExp(`(${escapeRegExp(query)})`, 'gi'),
//         '<mark>$1</mark>'
//       );
//       matches.push(`<p>${highlighted}</p>`);
//     }
//   }

//   if (matches.length > 0) {
//     resultsDiv.innerHTML = matches.join('');
//   } else {
//     resultsDiv.innerHTML = '<p>–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
//   }
//   resultsDiv.classList.add('active');
// }
  
function goToDeepParser(pageNum) {
  if (!originalFileArrayBuffer) {
    alert('–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    return;
  }

  // –°–æ–∑–¥–∞—ë–º Blob –∏–∑ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ PDF
  const blob = new Blob([originalFileArrayBuffer], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);

  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º: URL + –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  const deepUrl = `deep-parser.html?pdfUrl=${encodeURIComponent(url)}&page=${pageNum}`;
  const win = window.open(deepUrl, '_blank');

  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è (–Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  // URL.revokeObjectURL(url); ‚Äî –ù–ï –≤—ã–∑—ã–≤–∞–π —Å—Ä–∞–∑—É! –ò–Ω–∞—á–µ –Ω–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç —Ñ–∞–π–ª.
}

  </script>
</body>

</html>
